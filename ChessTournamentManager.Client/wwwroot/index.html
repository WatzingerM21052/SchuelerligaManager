<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schülerliga Manager</title>
    <base href="/" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="css/app.css" rel="stylesheet" />
    <link href="ChessTournamentManager.Client.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div class="d-flex justify-content-center align-items-center vh-100 bg-light">
            <div class="spinner-border text-primary" role="status"></div>
            <span class="ms-3 fw-bold text-secondary">Lade Enterprise System...</span>
        </div>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- 1. DOWNLOAD MANAGER (Gefixt für DB & CSV) ---
        window.downloadFile = (fileName, content) => {
            const link = document.createElement('a');
            link.download = fileName;
            link.href = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURIComponent(content);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        window.downloadBinaryFile = (fileName, base64String) => {
            const link = document.createElement('a');
            link.download = fileName;
            link.href = "data:application/octet-stream;base64," + base64String;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- 2. CHART.JS MANAGER ---
        window.chartManager = {
            instances: {},

            renderBarChart: (canvasId, labelName, labels, data, color) => {
                const ctx = document.getElementById(canvasId);
                if (!ctx) return;
                if (window.chartManager.instances[canvasId]) window.chartManager.instances[canvasId].destroy();

                window.chartManager.instances[canvasId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: labelName,
                            data: data,
                            backgroundColor: color || '#0d6efd',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#f0f0f0' }, ticks: { precision: 0 } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            },

            renderLineChart: (canvasId, labels, data) => {
                const ctx = document.getElementById(canvasId);
                if (!ctx) return;
                if (window.chartManager.instances[canvasId]) window.chartManager.instances[canvasId].destroy();

                window.chartManager.instances[canvasId] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Punkte',
                            data: data,
                            borderColor: '#198754',
                            backgroundColor: 'rgba(25, 135, 84, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#198754',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#f0f0f0' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
        };
    </script>
</body>

</html>