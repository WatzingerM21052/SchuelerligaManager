<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schülerligaverwaltung</title>
    <base href="/" />
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link href="css/app.css" rel="stylesheet" />
    <link href="ChessTournamentManager.Client.styles.css" rel="stylesheet" />

    <style>
        @keyframes chess-bounce { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-5px) rotate(5deg); } }
        .animated-chess-piece { display: inline-block; font-size: 2.5rem; color: #ffc107; text-shadow: 0 0 10px rgba(255, 193, 7, 0.5); animation: chess-bounce 3s infinite ease-in-out; }
    </style>
</head>
<body class="bg-light">
    <div id="app">
        <div class="d-flex justify-content-center align-items-center vh-100">
            <div class="spinner-border text-primary" role="status"></div>
            <span class="ms-3 fw-bold text-secondary">Lade Schülerligaverwaltung...</span>
        </div>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        window.downloadFile = (fileName, content) => {
            const link = document.createElement('a'); link.download = fileName; link.href = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURIComponent(content);
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        };

        window.downloadBinaryFile = (fileName, base64String) => {
            const link = document.createElement('a'); link.download = fileName; link.href = "data:application/octet-stream;base64," + base64String;
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        };

        window.chartManager = {
            instances: {},
            renderBarChart: (canvasId, labelName, labels, data, color) => {
                const ctx = document.getElementById(canvasId); if (!ctx) return;
                if (window.chartManager.instances[canvasId]) window.chartManager.instances[canvasId].destroy();
                window.chartManager.instances[canvasId] = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: labelName, data: data, backgroundColor: color || '#0d6efd', borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f0f0f0' } }, x: { grid: { display: false } } } } });
            },
            renderLineChart: (canvasId, labels, data) => {
                const ctx = document.getElementById(canvasId); if (!ctx) return;
                if (window.chartManager.instances[canvasId]) window.chartManager.instances[canvasId].destroy();
                window.chartManager.instances[canvasId] = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [{ label: 'Punkte', data: data, borderColor: '#198754', backgroundColor: 'rgba(25, 135, 84, 0.1)', borderWidth: 2, fill: true, tension: 0.3, pointRadius: 4, pointBackgroundColor: '#fff', pointBorderColor: '#198754' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f0f0f0' } }, x: { grid: { display: false } } } } });
            }
        };

        window.browserStorage = {
            dbName: "ChessTournamentDB", storeName: "databaseFiles",
            init: () => new Promise((resolve, reject) => { 
                const req = indexedDB.open(window.browserStorage.dbName, 1); 
                req.onupgradeneeded = e => e.target.result.createObjectStore(window.browserStorage.storeName); 
                req.onsuccess = () => resolve(req.result); req.onerror = () => reject(); 
            }),
            saveDb: async (base64Data) => { 
                const db = await window.browserStorage.init(); 
                return new Promise(r => { 
                    const tx = db.transaction(window.browserStorage.storeName, "readwrite"); 
                    tx.objectStore(window.browserStorage.storeName).put(base64Data, "chess.db"); 
                    tx.oncomplete = () => r(true); 
                }); 
            },
            loadDb: async () => { 
                const db = await window.browserStorage.init(); 
                return new Promise(r => { 
                    const tx = db.transaction(window.browserStorage.storeName, "readonly"); 
                    const req = tx.objectStore(window.browserStorage.storeName).get("chess.db"); 
                    req.onsuccess = () => r(req.result); req.onerror = () => r(null); 
                }); 
            },
            deleteDb: async () => {
                const db = await window.browserStorage.init(); 
                return new Promise(r => { 
                    const tx = db.transaction(window.browserStorage.storeName, "readwrite"); 
                    tx.objectStore(window.browserStorage.storeName).delete("chess.db"); 
                    tx.oncomplete = () => r(true); 
                });
            }
        };
    </script>
</body>
</html>